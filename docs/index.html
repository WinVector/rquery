<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relational Query Generator for Data Manipulation at Scale • rquery</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Relational Query Generator for Data Manipulation at Scale">
<meta property="og:description" content="A piped query generator based on Edgar F. Codd's relational
    algebra, and on production experience using 'SQL' and 'dplyr' at big data
    scale.  The design represents an attempt to make 'SQL' more teachable by
    denoting composition by a sequential pipeline notation instead of nested
    queries or functions.   The implementation delivers reliable high 
    performance data processing on large data systems such as 'Spark',
    databases, and 'data.table'. Package features include: data processing trees
    or pipelines as observable objects (able to report both columns
    produced and columns used), optimized 'SQL' generation as an explicit
    user visible table modeling step, plus explicit query reasoning and checking.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">rquery</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/AssigmentPartitioner.html">Assignment Partitioner</a>
    </li>
    <li>
      <a href="articles/Parameterized_rquery.html">Parameterized rquery</a>
    </li>
    <li>
      <a href="articles/PipeableSQL.html">Pipeable SQL</a>
    </li>
    <li>
      <a href="articles/QueryGeneration.html">Query Generation</a>
    </li>
    <li>
      <a href="articles/R_mapping.html">R mapping</a>
    </li>
    <li>
      <a href="articles/rquery_intro.html">rquery Introduction</a>
    </li>
    <li>
      <a href="articles/rquery_substitution.html">rquery Substitution</a>
    </li>
    <li>
      <a href="articles/sql_quoting.html">SQL quoting</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/WinVector/rquery">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="rquery" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#rquery" class="anchor"></a><code>rquery</code>
</h1></div>
<p><a href="https://winvector.github.io/rquery/"><code>rquery</code></a> is a piped query generator based on <a href="https://en.wikipedia.org/wiki/Relational_algebra">Codd’s relational algebra</a> (updated to reflect lessons learned from working with <a href="https://www.r-project.org"><code>R</code></a>, <a href="https://en.wikipedia.org/wiki/SQL"><code>SQL</code></a>, and <a href="https://CRAN.R-project.org/package=dplyr"><code>dplyr</code></a> at big data scale in production).</p>
<p><code>rquery</code> is currently recommended for use with <a href="http://r-datatable.com"><code>data.table</code></a> (via <a href="https://github.com/WinVector/rqdatatable/"><code>rqdatatable</code></a>), <a href="https://github.com/WinVector/rquery/blob/master/db_examples/RPostgreSQL.md"><code>PostgreSQL</code></a>, <a href="https://github.com/WinVector/rquery/blob/master/db_examples/sparklyr.md"><code>sparklyr</code></a>, <a href="https://github.com/WinVector/rquery/blob/master/db_examples/SparkR.md"><code>SparkR</code></a>, <a href="https://github.com/WinVector/rquery/blob/master/db_examples/MonetDBLite.md"><code>MonetDBLite</code></a>, and (and with non-window functionality with <a href="https://CRAN.R-project.org/package=RSQLite"><code>RSQLite</code></a>). It can target various databases through its adapter layer.</p>
<p>Note: <code>rquery</code> is a “database first” design. This means choices are made that favor database implementation. These include: capturing the entire calculation prior to doing any work (and using recursive methods to inspect this object, which can limit the calculation depth to under 1000 steps at a time), preferring “tame column names” (which isn’t a bad idea in <code>R</code> anyway as columns and variables are often seen as cousins), and not preserving row or column order (or supporting numeric column indexing). Also, <code>rquery</code> does have a fast in-memory implementation: <a href="https://CRAN.R-project.org/package=rqdatatable"><code>rqdatatable</code></a> (thanks to the <a href="https://CRAN.R-project.org/package=data.table"><code>data.table</code> package</a>), so one can in fact use <code>rquery</code> without a database.</p>
<p><img src="https://github.com/WinVector/rquery/raw/master/tools/rquery.jpg"></p>
</div>
<div id="discussion" class="section level1">
<h1 class="hasAnchor">
<a href="#discussion" class="anchor"></a>Discussion</h1>
<p><a href="https://github.com/WinVector/rquery"><code>rquery</code></a> can be an excellent advanced <code>SQL</code> training tool (it shows how to build some very deep <code>SQL</code> by composing <code>rquery</code> operators). Currently <code>rquery</code> is biased towards the <code>Spark</code> and <code>PostgeSQL</code> <code>SQL</code> dialects.</p>
<p>There are many prior relational algebra inspired specialized query languages. Just a few include:</p>
<ul>
<li>
<a href="https://en.wikipedia.org/wiki/Alpha_(programming_language)"><code>Alpha</code></a> ~1971.</li>
<li>
<code>ISBL</code> / Information system based language ~1973</li>
<li>
<a href="https://en.wikipedia.org/wiki/QUEL_query_languages"><code>QUEL</code></a> ~1974.</li>
<li>
<a href="https://en.wikipedia.org/wiki/IBM_System_R"><code>IBM System R</code></a> ~1974.</li>
<li>
<a href="https://en.wikipedia.org/wiki/SQL"><code>SQL</code></a> ~1974.</li>
<li>
<a href="https://en.wikipedia.org/wiki/D_(data_language_specification)#Tutorial_D"><code>Tutorial D</code></a> ~1994.</li>
<li>
<a href="http://r-datatable.com/"><code>data.table</code></a> ~2006.</li>
<li>
<a href="https://msdn.microsoft.com/en-us/library/bb308959.aspx"><code>LINQ</code></a> ~2007.</li>
<li>
<a href="http://pandas.pydata.org"><code>pandas</code></a> ~2008.</li>
<li>
<a href="http://dplyr.tidyverse.org"><code>dplyr</code></a> ~2014.</li>
</ul>
<p><code>rquery</code> is realized as a thin translation to an underlying <code>SQL</code> provider. We are trying to put the Codd relational operators front and center (using the original naming, and back-porting <code>SQL</code> progress such as window functions to the appropriate relational operator).</p>
<p>The primary relational operators include:</p>
<ul>
<li>
<a href="https://winvector.github.io/rquery/reference/extend.html"><code><a href="reference/extend.html">extend()</a></code></a>. Extend adds derived columns to a relation table. With a sufficiently powerful <code>SQL</code> provider this includes ordered and partitioned window functions. This operator also includes built-in <a href="https://winvector.github.io/seplyr/"><code>seplyr</code></a>-style <a href="https://winvector.github.io/seplyr/articles/MutatePartitioner.html">assignment partitioning</a>. <code><a href="reference/extend.html">extend()</a></code> can also alter existing columns, though we note this is not always a relational operation (it can lose row uniqueness).</li>
<li>
<a href="https://winvector.github.io/rquery/reference/project.html"><code><a href="reference/project.html">project()</a></code></a>. Project is usually <em>portrayed</em> as the equivalent to column selection, though the original definition includes aggregation. In our opinion the original relational nature of the operator is best captured by moving <code>SQL</code>’s “<code>GROUP BY</code>” aggregation functionality.</li>
<li>
<a href="https://winvector.github.io/rquery/reference/natural_join.html"><code><a href="reference/natural_join.html">natural_join()</a></code></a>. This a specialized relational join operator, using all common columns as an equi-join condition.</li>
<li>
<a href="https://winvector.github.io/rquery/reference/theta_join.html"><code><a href="reference/theta_join.html">theta_join()</a></code></a>. This is the relational join operator allowing an arbitrary matching predicate.</li>
<li>
<a href="https://winvector.github.io/rquery/reference/theta_join.html"><code><a href="reference/select_rows.html">select_rows()</a></code></a>. This is Codd’s relational row selection. Obviously <code>select</code> alone is an over-used and now ambiguous term (for example: it is already used as the “doit” verb in <code>SQL</code> and the <em>column</em> selector in <code>dplyr</code>).</li>
<li>
<a href="https://winvector.github.io/rquery/reference/rename_columns.html"><code><a href="reference/rename_columns.html">rename_columns()</a></code></a>. This operator renames sets of columns.</li>
<li>
<a href="https://winvector.github.io/rquery/reference/set_indicator.html"><code><a href="reference/set_indicator.html">set_indicator()</a></code></a>. This operator produces a new column indicating set membership of a named column.</li>
</ul>
<p>(Note <code>rquery</code> prior to version <code>1.2.1</code> used a <code>_nse()</code> suffix yielding commands such as <code><a href="reference/extend.html">extend_nse()</a></code> instead of the newer <code><a href="reference/extend.html">extend()</a></code> shown here).</p>
<p>The primary non-relational (traditional <code>SQL</code>) operators are:</p>
<ul>
<li>
<a href="https://winvector.github.io/rquery/reference/select_columns.html"><code><a href="reference/select_columns.html">select_columns()</a></code></a>. This allows choice of columns (central to <code>SQL</code>), but is not a relational operator as it can damage row-uniqueness.</li>
<li>
<a href="https://winvector.github.io/rquery/reference/orderby.html"><code><a href="reference/orderby.html">orderby()</a></code></a>. Row order is not a concept in the relational algebra (and also not maintained in most <code>SQL</code> implementations). This operator is only useful when used with its <code>limit=</code> option, or as the last step as data comes out of the relation store and is moved to <code>R</code> (where row-order is usually maintained).</li>
<li>
<a href="https://winvector.github.io/rquery/reference/map_column_values.html"><code><a href="reference/map_column_values.html">map_column_values()</a></code></a> re-map values in columns (very useful for re-coding data, currently implemented as a <a href="https://winvector.github.io/rquery/reference/sql_node.html"><code><a href="reference/sql_node.html">sql_node()</a></code></a>).</li>
<li>
<a href="https://winvector.github.io/rquery/reference/unionall.html"><code><a href="reference/unionall.html">unionall()</a></code></a> concatenate tables.</li>
</ul>
<p>And <code>rquery</code> supports higher-order (written in terms of other operators, both package supplied and user supplied):</p>
<ul>
<li>
<a href="https://winvector.github.io/rquery/reference/pick_top_k.html"><code><a href="reference/pick_top_k.html">pick_top_k()</a></code></a>. Pick top <code>k</code> rows per group given a row ordering.</li>
<li>
<a href="https://winvector.github.io/rquery/reference/assign_slice.html"><code><a href="reference/assign_slice.html">assign_slice()</a></code></a>. Conditionally assign sets of rows and columns a scalar value.</li>
<li>
<a href="https://winvector.github.io/rquery/reference/if_else_op.html"><code><a href="reference/if_else_op.html">if_else_op()</a></code></a>. Simulate simultaneous if/else assignments.</li>
</ul>
<p><code>rquery</code> also has implementation helpers for building both <code>SQL</code>-nodes (nodes that are just <code>SQL</code> expressions) and non-<code>SQL</code>-nodes (nodes that are general functions of their input data values).</p>
<ul>
<li><a href="https://winvector.github.io/rquery/reference/sql_node.html"><code><a href="reference/sql_node.html">sql_node()</a></code></a></li>
<li><a href="https://winvector.github.io/rquery/reference/sql_expr_set.html"><code><a href="reference/sql_expr_set.html">sql_expr_set()</a></code></a></li>
<li><a href="https://winvector.github.io/rquery/reference/non_sql_node.html"><code><a href="reference/non_sql_node.html">non_sql_node()</a></code></a></li>
<li><a href="https://winvector.github.io/rquery/reference/quantile_node.html"><code><a href="reference/quantile_node.html">quantile_node()</a></code></a></li>
<li><a href="https://winvector.github.io/rquery/reference/rsummary_node.html"><code><a href="reference/rsummary_node.html">rsummary_node()</a></code></a></li>
</ul>
<p>The primary missing relational operators are:</p>
<ul>
<li>Union.</li>
<li>Direct set difference, anti-join.</li>
<li>Division.</li>
</ul>
<p>One of the principles of <code>rquery</code> is to prefer expressive nodes, and not depend on complicated in-node expressions.</p>
<p>A great benefit of Codd’s relational algebra is it gives one concepts to decompose complex data transformations into sequences of simpler transformations.</p>
<p>Some reasons <code>SQL</code> seems complicated include:</p>
<ul>
<li>
<code>SQL</code>’s realization of sequencing as nested function composition.</li>
<li>
<code>SQL</code> uses some relational concepts as steps, others as modifiers and predicates.</li>
</ul>
<p>A lot of the grace of the Codd theory can be recovered through the usual trick changing function composition notation from <code>g(f(x))</code> to <code>x . f() . g()</code>. This experiment is asking (and not for the first time): “what if <code>SQL</code> were piped (expressed composition as a left to right flow, instead of a right to left nesting)?”</p>
<p>Let’s work a non-trivial example: the <code>dplyr</code> pipeline from <a href="http://www.win-vector.com/blog/2017/08/lets-have-some-sympathy-for-the-part-time-r-user/">Let’s Have Some Sympathy For The Part-time R User</a>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"rquery"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"wrapr"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">use_spark &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="cf">if</span>(use_spark) {</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  raw_connection &lt;-<span class="st"> </span>sparklyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sparklyr/topics/spark-connections">spark_connect</a></span>(<span class="dt">version=</span><span class="st">'2.2.0'</span>, </a>
<a class="sourceLine" id="cb1-7" data-line-number="7">                                   <span class="dt">master =</span> <span class="st">"local"</span>)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">  cname &lt;-<span class="st"> </span><span class="kw"><a href="reference/rq_connection_name.html">rq_connection_name</a></span>(raw_connection)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">  rquery<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rquery/topics/setDBOption">setDBOption</a></span>(raw_connection, </a>
<a class="sourceLine" id="cb1-10" data-line-number="10">                      <span class="st">"create_options"</span>,</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">                      <span class="st">"USING PARQUET OPTIONS ('compression'='snappy')"</span>)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">  driver &lt;-<span class="st"> </span>RPostgreSQL<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/RPostgreSQL/topics/PostgreSQL">PostgreSQL</a></span>()</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">  <span class="co">#driver &lt;- RPostgres::Postgres()</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15">  raw_connection &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/DBI/topics/dbConnect">dbConnect</a></span>(driver,</a>
<a class="sourceLine" id="cb1-16" data-line-number="16">                          <span class="dt">host =</span> <span class="st">'localhost'</span>,</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">                          <span class="dt">port =</span> <span class="dv">5432</span>,</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">                          <span class="dt">user =</span> <span class="st">'johnmount'</span>,</a>
<a class="sourceLine" id="cb1-19" data-line-number="19">                          <span class="dt">password =</span> <span class="st">''</span>)</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">}</a>
<a class="sourceLine" id="cb1-21" data-line-number="21"></a>
<a class="sourceLine" id="cb1-22" data-line-number="22">dbopts &lt;-<span class="st"> </span><span class="kw"><a href="reference/rq_connection_tests.html">rq_connection_tests</a></span>(raw_connection)</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">db &lt;-<span class="st"> </span><span class="kw"><a href="reference/rquery_db_info.html">rquery_db_info</a></span>(<span class="dt">connection =</span> raw_connection,</a>
<a class="sourceLine" id="cb1-24" data-line-number="24">                     <span class="dt">is_dbi =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb1-25" data-line-number="25">                     <span class="dt">connection_options =</span> dbopts)</a>
<a class="sourceLine" id="cb1-26" data-line-number="26"></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="co"># copy data in so we have an example</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28">d_local &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/wrapr/topics/build_frame">build_frame</a></span>(</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">   <span class="st">"subjectID"</span>, <span class="st">"surveyCategory"</span>     , <span class="st">"assessmentTotal"</span>, <span class="st">"irrelevantCol1"</span>, <span class="st">"irrelevantCol2"</span> <span class="op">|</span></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="st">   </span>1L         , <span class="st">"withdrawal behavior"</span>, <span class="dv">5</span>                , <span class="st">"irrel1"</span>        , <span class="st">"irrel2"</span>         <span class="op">|</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31"><span class="st">   </span>1L         , <span class="st">"positive re-framing"</span>, <span class="dv">2</span>                , <span class="st">"irrel1"</span>        , <span class="st">"irrel2"</span>         <span class="op">|</span></a>
<a class="sourceLine" id="cb1-32" data-line-number="32"><span class="st">   </span>2L         , <span class="st">"withdrawal behavior"</span>, <span class="dv">3</span>                , <span class="st">"irrel1"</span>        , <span class="st">"irrel2"</span>         <span class="op">|</span></a>
<a class="sourceLine" id="cb1-33" data-line-number="33"><span class="st">   </span>2L         , <span class="st">"positive re-framing"</span>, <span class="dv">4</span>                , <span class="st">"irrel1"</span>        , <span class="st">"irrel2"</span>         )</a>
<a class="sourceLine" id="cb1-34" data-line-number="34"><span class="kw"><a href="reference/rq_copy_to.html">rq_copy_to</a></span>(db, <span class="st">'d'</span>,</a>
<a class="sourceLine" id="cb1-35" data-line-number="35">            d_local,</a>
<a class="sourceLine" id="cb1-36" data-line-number="36">            <span class="dt">temporary =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb1-37" data-line-number="37">            <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] "table(\"d\"; subjectID, surveyCategory, assessmentTotal, irrelevantCol1, irrelevantCol2)"</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># produce a hande to existing table</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">d &lt;-<span class="st"> </span><span class="kw"><a href="reference/db_td.html">db_td</a></span>(db, <span class="st">"d"</span>)</a></code></pre></div>
<p>Note: in examples we use <code><a href="reference/rq_copy_to.html">rq_copy_to()</a></code> to create data. This is only for the purpose of having easy portable examples. With big data the data is usually already in the remote database or Spark system. The task is almost always to connect and work with this pre-existing remote data and the method to do this is <a href="https://winvector.github.io/rquery/reference/db_td.html"><code><a href="reference/db_td.html">db_td()</a></code></a>, which builds a reference to a remote table given the table name. The suggested pattern for working with remote tables is to get inputs via <a href="https://winvector.github.io/rquery/reference/db_td.html"><code><a href="reference/db_td.html">db_td()</a></code></a> and land remote results with <a href="https://winvector.github.io/rquery/reference/materialize.html"><code>materialze()</code></a>. To work with local data one can copy data from memory to the database with <a href="https://winvector.github.io/rquery/reference/rq_copy_to.html"><code><a href="reference/rq_copy_to.html">rq_copy_to()</a></code></a> and bring back results with <a href="https://winvector.github.io/rquery/reference/execute.html"><code><a href="reference/execute.html">execute()</a></code></a> (though be aware operation on remote non-memory data is <code>rquery</code>’s primary intent).</p>
<p>First we show the Spark/database version of the original example data:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(db)</a></code></pre></div>
<pre><code>## [1] "rquery_db_info"</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(db)</a></code></pre></div>
<pre><code>## [1] "rquery_db_info(PostgreSQLConnection, is_dbi=TRUE, note=\"\")"</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(d)</a></code></pre></div>
<pre><code>## [1] "relop_table_source" "relop"</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(d)</a></code></pre></div>
<pre><code>## [1] "table(\"d\"; subjectID, surveyCategory, assessmentTotal, irrelevantCol1, irrelevantCol2)"</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># remote structure inspection</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw"><a href="reference/rstr.html">rstr</a></span>(db, d<span class="op">$</span>table_name)</a></code></pre></div>
<pre><code>## table "d" rquery_db_info 
##  nrow: 4 
## 'data.frame':    4 obs. of  5 variables:
##  $ subjectID      : int  1 1 2 2
##  $ surveyCategory : chr  "withdrawal behavior" "positive re-framing" "withdrawal behavior" "positive re-framing"
##  $ assessmentTotal: num  5 2 3 4
##  $ irrelevantCol1 : chr  "irrel1" "irrel1" "irrel1" "irrel1"
##  $ irrelevantCol2 : chr  "irrel2" "irrel2" "irrel2" "irrel2"</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># or execute the table representation to bring back data</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">d <span class="op">%.&gt;%</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="reference/execute.html">execute</a></span>(db, .) <span class="op">%.&gt;%</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(.)</a></code></pre></div>
<table class="table table">
<thead><tr class="header">
<th align="right">subjectID</th>
<th align="left">surveyCategory</th>
<th align="right">assessmentTotal</th>
<th align="left">irrelevantCol1</th>
<th align="left">irrelevantCol2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">withdrawal behavior</td>
<td align="right">5</td>
<td align="left">irrel1</td>
<td align="left">irrel2</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">positive re-framing</td>
<td align="right">2</td>
<td align="left">irrel1</td>
<td align="left">irrel2</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="left">withdrawal behavior</td>
<td align="right">3</td>
<td align="left">irrel1</td>
<td align="left">irrel2</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">positive re-framing</td>
<td align="right">4</td>
<td align="left">irrel1</td>
<td align="left">irrel2</td>
</tr>
</tbody>
</table>
<p>Now we re-write the original calculation in terms of the <code>rquery</code> SQL generating operators.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">scale &lt;-<span class="st"> </span><span class="fl">0.237</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">dq &lt;-<span class="st"> </span>d <span class="op">%.&gt;%</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="reference/extend.html">extend</a></span>(.,</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">         probability <span class="op">:</span><span class="er">=</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="st">           </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(assessmentTotal <span class="op">*</span><span class="st"> </span>scale))  <span class="op">%.&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="reference/normalize_cols.html">normalize_cols</a></span>(.,</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">                 <span class="st">"probability"</span>,</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">                 <span class="dt">partitionby =</span> <span class="st">'subjectID'</span>) <span class="op">%.&gt;%</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="reference/pick_top_k.html">pick_top_k</a></span>(.,</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">             <span class="dt">partitionby =</span> <span class="st">'subjectID'</span>,</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">             <span class="dt">orderby =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'probability'</span>, <span class="st">'surveyCategory'</span>),</a>
<a class="sourceLine" id="cb15-13" data-line-number="13">             <span class="dt">reverse =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'probability'</span>)) <span class="op">%.&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="reference/rename_columns.html">rename_columns</a></span>(., <span class="st">'diagnosis'</span> <span class="op">:</span><span class="er">=</span><span class="st"> 'surveyCategory'</span>) <span class="op">%.&gt;%</span></a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="reference/select_columns.html">select_columns</a></span>(., <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'subjectID'</span>, </a>
<a class="sourceLine" id="cb15-16" data-line-number="16">                      <span class="st">'diagnosis'</span>, </a>
<a class="sourceLine" id="cb15-17" data-line-number="17">                      <span class="st">'probability'</span>)) <span class="op">%.&gt;%</span></a>
<a class="sourceLine" id="cb15-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="reference/orderby.html">orderby</a></span>(., <span class="dt">cols =</span> <span class="st">'subjectID'</span>)</a></code></pre></div>
<p>(Note one can also use the named map builder alias <code>%:=%</code> if there is concern of aliasing with <code>data.table</code>’s definition of <code>:=</code>.)</p>
<p>We then generate our result:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">result &lt;-<span class="st"> </span><span class="kw"><a href="reference/materialize.html">materialize</a></span>(db, dq)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(result)</a></code></pre></div>
<pre><code>## [1] "relop_table_source" "relop"</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">result</a></code></pre></div>
<pre><code>## [1] "table(\"rquery_mat_39716604339918344813_0000000000\"; subjectID, diagnosis, probability)"</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">DBI<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/DBI/topics/dbReadTable">dbReadTable</a></span>(db<span class="op">$</span>connection, result<span class="op">$</span>table_name) <span class="op">%.&gt;%</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(.)</a></code></pre></div>
<table class="table table">
<thead><tr class="header">
<th align="right">subjectID</th>
<th align="left">diagnosis</th>
<th align="right">probability</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">withdrawal behavior</td>
<td align="right">0.6706221</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">positive re-framing</td>
<td align="right">0.5589742</td>
</tr>
</tbody>
</table>
<p>We see we have quickly reproduced the original result using the new database operators. This means such a calculation could easily be performed at a “big data” scale (using a database or <code>Spark</code>; in this case we would not take the results back, but instead use <code>CREATE TABLE tname AS</code> to build a remote materialized view of the results).</p>
<p>A bonus is, thanks to <code>data.table</code> and the <code>rqdatatable</code> packages we can run the exact same operator pipeline on local data.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"rqdatatable"</span>)</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"></a>
<a class="sourceLine" id="cb21-3" data-line-number="3">d_local <span class="op">%.&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="st">  </span>dq <span class="op">%.&gt;%</span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(.)</a></code></pre></div>
<table class="table table">
<thead><tr class="header">
<th align="right">subjectID</th>
<th align="left">diagnosis</th>
<th align="right">probability</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">withdrawal behavior</td>
<td align="right">0.6706221</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">positive re-framing</td>
<td align="right">0.5589742</td>
</tr>
</tbody>
</table>
<p>Notice we applied the pipeline by piping data into it. This ability is a feature of the <a href="https://journal.r-project.org/archive/2018/RJ-2018-042/index.html">dot arrow pipe</a> we are using here.</p>
<p>The actual <code>SQL</code> query that produces the database result is, in fact, quite involved:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="kw"><a href="reference/to_sql.html">to_sql</a></span>(dq, db, <span class="dt">source_limit =</span> <span class="dv">1000</span>))</a></code></pre></div>
<pre><code>SELECT * FROM (
 SELECT
  "subjectID",
  "diagnosis",
  "probability"
 FROM (
  SELECT
   "subjectID" AS "subjectID",
   "surveyCategory" AS "diagnosis",
   "probability" AS "probability"
  FROM (
   SELECT * FROM (
    SELECT
     "subjectID",
     "surveyCategory",
     "probability",
     row_number ( ) OVER (  PARTITION BY "subjectID" ORDER BY "probability" DESC, "surveyCategory" ) AS "row_number"
    FROM (
     SELECT
      "subjectID",
      "surveyCategory",
      "probability" / sum ( "probability" ) OVER (  PARTITION BY "subjectID" ) AS "probability"
     FROM (
      SELECT
       "subjectID",
       "surveyCategory",
       exp ( "assessmentTotal" * 0.237 )  AS "probability"
      FROM (
       SELECT
        "subjectID",
        "surveyCategory",
        "assessmentTotal"
       FROM
        "d" LIMIT 1000
       ) tsql_65176259097603003401_0000000000
      ) tsql_65176259097603003401_0000000001
     ) tsql_65176259097603003401_0000000002
   ) tsql_65176259097603003401_0000000003
   WHERE "row_number" &lt;= 1
  ) tsql_65176259097603003401_0000000004
 ) tsql_65176259097603003401_0000000005
) tsql_65176259097603003401_0000000006 ORDER BY "subjectID"</code></pre>
<p>The query is large, but due to its regular structure it should be very amenable to query optimization.</p>
<p>A feature to notice is: the query was automatically restricted to just columns actually needed from the source table to complete the calculation. This has the possibility of decreasing data volume and greatly speeding up query performance. Our <a href="https://github.com/WinVector/rquery/blob/master/extras/PerfTest%2Emd">initial experiments</a> show <code>rquery</code> narrowed queries to be twice as fast as un-narrowed <code>dplyr</code> on a synthetic problem simulating large disk-based queries. We think if we connected directly to <code>Spark</code>’s relational operators (avoiding the <code>SQL</code> layer) we may be able to achieve even faster performance.</p>
<p>The above optimization is possible because the <code>rquery</code> representation is an intelligible tree of nodes, so we can interrogate the tree for facts about the query. For example:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw"><a href="reference/column_names.html">column_names</a></span>(dq)</a></code></pre></div>
<pre><code>## [1] "subjectID"   "diagnosis"   "probability"</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw"><a href="reference/tables_used.html">tables_used</a></span>(dq)</a></code></pre></div>
<pre><code>## [1] "d"</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw"><a href="reference/columns_used.html">columns_used</a></span>(dq)</a></code></pre></div>
<pre><code>## $d
## [1] "subjectID"       "surveyCategory"  "assessmentTotal"</code></pre>
<p>The additional record-keeping in the operator nodes allows checking and optimization (such as <a href="http://www.win-vector.com/blog/2017/12/how-to-greatly-speed-up-your-spark-queries/">query narrowing</a>). The flow itself is represented as follows:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/format">format</a></span>(dq))</a></code></pre></div>
<pre><code>table("d"; 
  subjectID,
  surveyCategory,
  assessmentTotal,
  irrelevantCol1,
  irrelevantCol2) %.&gt;%
 extend(.,
  probability := exp(assessmentTotal * 0.237)) %.&gt;%
 extend(.,
  probability := probability / sum(probability),
  p= subjectID) %.&gt;%
 extend(.,
  row_number := row_number(),
  p= subjectID,
  o= "probability" DESC, "surveyCategory") %.&gt;%
 select_rows(.,
   row_number &lt;= 1) %.&gt;%
 rename(.,
  c('diagnosis' = 'surveyCategory')) %.&gt;%
 select_columns(.,
   subjectID, diagnosis, probability) %.&gt;%
 orderby(., subjectID)</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">dq <span class="op">%.&gt;%</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="reference/op_diagram.html">op_diagram</a></span>(.) <span class="op">%.&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="st">  </span>DiagrammeR<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/DiagrammeR/topics/grViz">grViz</a></span>(.)</a></code></pre></div>
<p><img src="https://github.com/WinVector/rquery/raw/master/tools/pipe_diagram.png"></p>
<p><code>rquery</code> also includes a number of useful utilities (both as nodes and as functions).</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw"><a href="reference/quantile_cols.html">quantile_cols</a></span>(db, <span class="st">"d"</span>)</a></code></pre></div>
<pre><code>##   quantile_probability subjectID      surveyCategory assessmentTotal
## 1                 0.00         1 positive re-framing               2
## 2                 0.25         1 positive re-framing               2
## 3                 0.50         1 positive re-framing               3
## 4                 0.75         2 withdrawal behavior               4
## 5                 1.00         2 withdrawal behavior               5
##   irrelevantCol1 irrelevantCol2
## 1         irrel1         irrel2
## 2         irrel1         irrel2
## 3         irrel1         irrel2
## 4         irrel1         irrel2
## 5         irrel1         irrel2</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw"><a href="reference/rsummary.html">rsummary</a></span>(db, <span class="st">"d"</span>)</a></code></pre></div>
<pre><code>##            column index     class nrows nna nunique min max mean        sd
## 1       subjectID     1   integer     4   0      NA   1   2  1.5 0.5773503
## 2  surveyCategory     2 character     4   0       2  NA  NA   NA        NA
## 3 assessmentTotal     3   numeric     4   0      NA   2   5  3.5 1.2909944
## 4  irrelevantCol1     4 character     4   0       1  NA  NA   NA        NA
## 5  irrelevantCol2     5 character     4   0       1  NA  NA   NA        NA
##                lexmin              lexmax
## 1                &lt;NA&gt;                &lt;NA&gt;
## 2 positive re-framing withdrawal behavior
## 3                &lt;NA&gt;                &lt;NA&gt;
## 4              irrel1              irrel1
## 5              irrel2              irrel2</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">dq <span class="op">%.&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="reference/quantile_node.html">quantile_node</a></span>(.) <span class="op">%.&gt;%</span></a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="reference/execute.html">execute</a></span>(db, .)</a></code></pre></div>
<pre><code>##   quantile_probability subjectID           diagnosis probability
## 1                 0.00         1 positive re-framing   0.5589742
## 2                 0.25         1 positive re-framing   0.5589742
## 3                 0.50         1 positive re-framing   0.5589742
## 4                 0.75         2 withdrawal behavior   0.6706221
## 5                 1.00         2 withdrawal behavior   0.6706221</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">dq <span class="op">%.&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="reference/rsummary_node.html">rsummary_node</a></span>(.) <span class="op">%.&gt;%</span></a>
<a class="sourceLine" id="cb39-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="reference/execute.html">execute</a></span>(db, .)</a></code></pre></div>
<pre><code>##        column index     class nrows nna nunique       min       max
## 1   subjectID     1   integer     2   0      NA 1.0000000 2.0000000
## 2   diagnosis     2 character     2   0       2        NA        NA
## 3 probability     3   numeric     2   0      NA 0.5589742 0.6706221
##        mean         sd              lexmin              lexmax
## 1 1.5000000 0.70710678                &lt;NA&gt;                &lt;NA&gt;
## 2        NA         NA positive re-framing withdrawal behavior
## 3 0.6147982 0.07894697                &lt;NA&gt;                &lt;NA&gt;</code></pre>
<p>We have found most big-data projects either require joining very many tables (something <code>rquery</code> join planners help with, please see <a href="https://github.com/WinVector/rquery/blob/master/extras/JoinController%2Emd">here</a> and <a href="https://github.com/WinVector/rquery/blob/master/extras/JoinController%2Emd">here</a>) or they require working with wide data-marts (where <code>rquery</code> query narrowing helps, please see <a href="https://github.com/WinVector/rquery/blob/master/extras/PerfTest%2Emd">here</a>).</p>
<p>We can also stand <code>rquery</code> up on non-<code>DBI</code> sources such as <a href="https://github.com/WinVector/rquery/blob/master/extras/SparkR%2Emd"><code>SparkR</code></a> and also <a href="https://CRAN.R-project.org/package=data.table"><code>data.table</code></a>. The <code>data.table</code> adapter is being developed in the <a href="https://github.com/WinVector/rqdatatable"><code>rqdatatable</code></a> package, and can be <a href="http://www.win-vector.com/blog/2018/06/rqdatatable-rquery-powered-by-data-table/">quite fast</a>. Notice the examples in this mode all essentially use the same query pipeline, the user can choose where to apply it: in memory (<code>data.table</code>), in a <code>DBI</code> database (<code>PostgreSQL</code>, <code>Sparklyr</code>), and with even non-DBI systems (<code>SparkR</code>).</p>
</div>
<div id="see-also" class="section level1">
<h1 class="hasAnchor">
<a href="#see-also" class="anchor"></a>See also</h1>
<p>For deeper dives into specific topics, please see also:</p>
<ul>
<li><a href="https://github.com/WinVector/rquery/blob/master/extras/JoinController%2Emd">Join Controller</a></li>
<li><a href="https://github.com/WinVector/rquery/blob/master/extras/DependencySorting%2Emd">Join Dependency Sorting</a></li>
<li><a href="https://github.com/WinVector/rquery/blob/master/extras/AssigmentPartitioner%2Emd">Assignment Partitioner</a></li>
<li><a href="https://github.com/WinVector/rquery/blob/master/extras/ExtraDBs%2Emd">DifferentDBs</a></li>
<li><a href="https://github.com/WinVector/rqdatatable">rqdatatable</a></li>
</ul>
</div>
<div id="installing" class="section level1">
<h1 class="hasAnchor">
<a href="#installing" class="anchor"></a>Installing</h1>
<p>To install <code>rquery</code> please try <code><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages("rquery")</a></code>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=rquery">https://​cloud.r-project.org/​package=rquery</a>
</li>
<li>Browse source code at <br><a href="https://github.com/WinVector/rquery">https://​github.com/​WinVector/​rquery</a>
</li>
<li>Report a bug at <br><a href="https://github.com/WinVector/rquery/issues">https://​github.com/​WinVector/​rquery/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>John Mount <br><small class="roles"> Author, maintainer </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by John Mount.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
